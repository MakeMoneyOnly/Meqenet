pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
        // Enterprise-grade repositories for stable builds
        maven { url = "https://plugins.gradle.org/m2/" }
        maven { url = "https://repo1.maven.org/maven2/" }
        // Windows-compatible path handling for React Native gradle plugin
        maven {
            def pluginPath = new File(settingsDir, "../../../../node_modules/@react-native/gradle-plugin")
            if (pluginPath.exists()) {
                // Convert to URI for Windows compatibility
                url = pluginPath.toURI().toURL()
                println "[DEBUG] Using React Native Gradle plugin from: ${url}"
            } else {
                println "[WARNING] React Native Gradle plugin not found at: ${pluginPath.absolutePath}"
            }
        }
    }

    // Specify stable plugin versions to avoid dependency resolution issues
    plugins {
        id("org.jetbrains.kotlin.android") version "1.9.24"
        id("com.facebook.react.settings") version "0.76.5"
        // Add explicit React plugin resolution for CI environments
        id("com.facebook.react") version "0.76.5"
    }

    // For CI environments, use explicit plugin resolution
    if (System.getenv('CI') || System.getenv('GITHUB_ACTIONS')) {
        println "CI environment detected - using explicit plugin resolution"
        // Ensure React plugin is available via classpath in CI
        resolutionStrategy {
            eachPlugin {
                if (requested.id.namespace == "com.facebook.react") {
                    def pluginPath = new File(settingsDir, "../../../../node_modules/@react-native/gradle-plugin")
                    if (pluginPath.exists()) {
                        useModule("com.facebook.react:react-native-gradle-plugin:0.76.5")
                    }
                }
            }
        }
    } else {
        // Try to use includeBuild for local development if the plugin exists
        def pluginPath = '../../../node_modules/@react-native/gradle-plugin'
        def pluginDir = new File(settingsDir, pluginPath)
        if (pluginDir.exists() && pluginDir.isDirectory()) {
            println "Found React Native gradle plugin locally at: ${pluginDir.absolutePath}"
            includeBuild(pluginPath)
        } else {
            println "React Native gradle plugin not found locally, will use classpath resolution"
        }
    }
}

// React Native settings extension will be configured automatically by the plugin
// Removed manual configuration to avoid extension availability issues

rootProject.name = 'App'
include ':app'
